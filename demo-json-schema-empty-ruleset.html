<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <title>Conditions Demo</title>

  <script src="../webcomponentsjs/webcomponents.js"></script>
  <link rel="import" href="../polymer/polymer.html" />
  <link rel="import" href="at-form-rule-edit.html">
  <link rel="import" href="../at-core-form/at-core-form.html" />
  <style>
    #demoForm {
      position: relative;
      top: 0px;
      right: 0px;
      /*padding: 20px;*/
      width: 300px;
      background: #ddd;
    }

      #demoForm div {
        margin: 10px 0;
      }
  </style>

</head>
<body unresolved>
  <h2>Conditions and Actions Demo - empty ruleset</h2>

  <at-form-rule-edit id="ruleEdit" defaultactions="false" defaultconditions="false">
    <!--<form id="demoForm">
      <h3>Try Changing These Values...</h3>
      <div><label>Name</label><input type="text" id="nameField" /></div>
      <div><label>Age</label><input type="text" id="ageField" size="2" /></div>
      <div>
        <label>Occupation</label>
        <select id="occupationField"></select>
      </div>
      <div><button type="submit" id="submit">Run Conditions and Actions</button></div>
    </form>-->
    <at-core-form id="demoForm"></at-core-form>
    <input type="submit" id="submit" value="submit" />
  </at-form-rule-edit>
  

  <script>
    document.addEventListener('polymer-ready', function () {
      var occupationOptions = [
        { label: "", name: "" },
        { label: "Software Engineer", name: "software-engineer" },
        { label: "Biz Dev", name: "biz-dev" },
        { label: "Marketing", name: "marketing" }
      ];
      var stateOptions = [
        { label: "Optional", name: "optional" },
        { label: "Required", name: "required" },
        { label: "Hidden", name: "hidden" },
        { label: "Disabled", name: "disabled" }
      ];

      var schema = {
        "properties":
        {
          "id": { "description": "The unique identifier for a product", "type": "number" },
          "name": { "type": "string", "required": "true", "xinputmode": "required" },
          "city": { "type": "string", "default": "Default city name" },
          "active": { "type": "boolean" },
          "activePera": { "type": "boolean", "description": "This is description for pera" },
          "dropdownDemo": { "title": "Name", "type": "string", "xtype": "enum", "xvaluelist": "XML,JSON", "default": "XML" },
          "card": { "title": "Card", "type": "string", "xtype": "lookup", "xurl": "http://localhost:2014/Activity/adenin.GateKeeper.Content/card/" }
        },
        "required": ["id", "city"]
      };

      //var conditionsConfig = {
      //  "name": { "type": "string" },
      //  "age": { "type": "number" },
      //  "booleanTest": { "type": "boolean", "default": "false", "options": [{ label: "true", name: "true" }, { label: "false", name: "false" }], "defaultOperator": "equalTo" },
      //  "occupation": { "type": "enum", "options": occupationOptions }
      //};

      window.test = this.$;

      // use window.test.ruleEdit.collectConditionsData() and window.test.ruleEdit.collectActionsData() to get changed values
      var ruleEdit = document.getElementById('ruleEdit');
      ruleEdit.schema = schema;
      //this.$.ruleEdit.actions = actionsConfig;
      //ruleEdit.actions = conditionsConfig;
      //ruleEdit.actions = { fields: [], data: [] };

      var demoForm = document.getElementById('demoForm');
      demoForm.schema = schema;

      initializeForm(demoForm);
      

      function initializeForm() {

        var submit = document.getElementById('submit');
        submit.addEventListener('click', function (e) {
          e.preventDefault();
          var lConditions = ruleEdit.collectConditionsData();
          var lActions = ruleEdit.collectActionsData();
          var engine = new RuleEngine({
            conditions: lConditions,
            actions: lActions
          });

          // conditions adapter is pairs of
          var conditionsAdapter = {
            "idField": demoForm.dataBindingObject["id"],
            "nameField": demoForm.dataBindingObject["name"],
            "cityField": demoForm.dataBindingObject["city"],
            "activeField": demoForm.dataBindingObject["active"],
            "activePeraField": demoForm.dataBindingObject["activePera"],
            "dropdownDemoField": demoForm.dataBindingObject["dropdownDemo"],
            "cardField": demoForm.dataBindingObject["card"]
          };
          var actionsAdapter = {
            alert: function (data) {
              alert(data.find("message"));
            },
            updateField: function (data) {
              console.log("data", data);
              var fieldId = data.find("fieldId");
              console.log("fieldId", fieldId);
              var val = data.find("fieldId", "newValue");
              fieldId = fieldId.replace('Field', '');
              if (val === "true") { val = true; }
              if (val === "false") { val = false;}
              demoForm.dataBindingObject[fieldId] = val;
            }
          };
          engine.run(conditionsAdapter, actionsAdapter);
        });
      }
    });
  </script>

</body>
</html>
